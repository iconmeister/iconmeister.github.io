<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta is="viewport" content="width=device-width, initial-scale=1" />
    <meta is="Description" content="IconMeister : SVG icons created by one Custom Element" />
    <link id="favicon" rel="shortcut icon" href="" width="32px" />
    <!-- <link rel="prefetch" async href="./icon/clarity.json" as="fetch"> -->

    <title>SVG icons in one Custom Element/Web Component</title>
    <script id="elements" src="elements.iconmeister.js"></script>
  </head>

  <body>
    <style>
      body {
        --maxwidth: 800px;
        --margintop: 95px;
        --border: 1px solid grey;
        max-width: var(--maxwidth);
        max-height: 100vh;
        margin: 0 auto;
        font: 14px arial;
        --codebackground: lightgrey;
        --iconwidth: 40px;
        --iconbackground: grey;
        --iconbackground-hover: lightgreen;
        --iconbackground-selected: lightgreen;
      }
      header {
        width: var(--maxwidth);
        border-bottom: var(--border);
      }
      header h1 {
        margin: 2px 0;
      }
      main {
        width: var(--maxwidth);
        overflow-x: hidden;
        overflow-y: hidden;
        /* height: 100vh; */
        /* scroll-snap-type: y mandatory; */
      }
      section {
        /* margin-top: var(--margintop); */
        /*scroll-snap-align: start;
        scroll-margin: var(--margintop); */
      }
      footer {
        width: var(--maxwidth);
        border-top: var(--border);
        padding: 0.5em 0;
      }
      svg-icon {
        box-sizing: initial;
        display: inline-block;
        position: relative;
        width: var(--iconwidth);
        height: var(--iconwidth);
        background: lightcoral;
      }

      svg-icon:hover {
        cursor: pointer;
        background: var(--iconbackground-hover);
      }

      svg-icon {
        box-sizing: border-box;
        max-width: var(--iconwidth);
        background: var(--iconbackground);
      }
      svg-icon[selected] img {
        background: var(--iconbackground-selected);
      }
      .demohtml {
        font-size: 120%;
        vertical-align: middle;
        padding-left: 0.5em;
      }
      .code {
        /* margin-left: 1em; */
        background: var(--codebackground);
        white-space: pre;
      }

      #_loadstatus {
        color: red;
      }
      h3,
      h4 {
        margin-left: 1em;
      }
      h3 + div {
        margin-left: 3em;
      }
      h4 {
        margin: 0.2em;
        margin-left: 1em;
      }
      .iconlist {
        margin-left: 1em;
      }
      #_sectionAvailableIcons {
        --iconwidth: 20px;
        padding-right: 1em;
        max-height: 550px;
        background: lightgrey;
        overflow: scroll;
        margin-bottom: 4em;
      }
      .HRicons {
        width: 400px;
        margin: 0 auto;
      }
      #_iconcount {
        font-weight: bold;
        color: darkred;
      }
      #_elementsCode {
        width: 100%;
        max-height: 15em;
        background: lightgreen;
        font-size: 12px;
      }
    </style>
    <style id="svg-icon-labels">
      svg-icon:hover:after {
        position: absolute;
        left: 0;
        top: -1em;
        width: 10em;
        z-index: 99;
        background: white;
        font-size: 12px;
        color: black;
        content: "img:" attr(is);
      }

      svg-icon[svg="1"]:hover:after {
        content: "svg:" attr(is);
      }
    </style>
    <header>
      <h1>
        [Work In Progress] W3C Custom Element: <b>&lt;svg-icon></b>
        <span hidden> in <span id="elementsSize"></span> Bytes (gzip)</span>
      </h1>
      <p>
        <a href="https://github.com/iconmeister/iconmeister.github.io">Github</a> -
        <a href="https://github.com/iconmeister/iconmeister.github.io/blob/master/elements.iconmeister.js"
          >sourcecode</a
        >
        <span id="_loadstatus"></span>
      </p>
      <p>
        <b>No</b> external SVG, <b>No</b> external JS files. &nbsp;pick icons from
        <span id="_iconcount"></span> Bootstrap, Feather and Clarity icons
      </p>
    </header>
    <main id="_main">
      <section>
        <div class="HRicons">
          <svg-icon is="im"></svg-icon>
          <svg-icon is="im" stroke="yellow"></svg-icon>
          <svg-icon is="im" width=".5"></svg-icon>
          <svg-icon is="im" fill="red"></svg-icon>
          <svg-icon is="im" rotate="45"></svg-icon>
          <svg-icon is="im" scale=".5"></svg-icon>
          <svg-icon is="im" opacity=".5"></svg-icon>
          <svg-icon is="im" tile="lightgreen"></svg-icon>
          <svg-icon is="im" border="stroke='red' stroke-width='3' stroke-dasharray='3 3 3'"></svg-icon>
        </div>
        IconMeister does <b>not</b> Import SVG. IconMeister <b>generates</b> SVG from a configuraton String.

        <pre class="code">
&lt;script>
  ((              // created from one IIFE, no global scope pollution
    icons,        // configurable icons (parameter below)
    {attributes}  // many attributes, extendible in source code
  )=>{
      // IconMeister JS code defining Custom Element &lt;svg-icon>&lt;/svg-icon>
  })({
    "im"    : "box:9;path:m3 3h3v3h-3z", // SVG icon used in this documentation page
    "icon2" : "box:24;path:M12 12h12 ...",
    "icon3" : "box:20;path:M0 0A10 ...",
    ...
  })
&lt;/script></pre
        >
        <h3>IconMeister creates an IMG or Inline SVG Element:</h3>
        <div id="svgorimg">
          <svg-icon is="im"></svg-icon>
          The SVG is injected as <code>data:image/svg</code> into an IMG tag:
          <pre class="code">&lt;svg-icon>&lt;img src='data:image/svg+xml,[SVG]'>&lt;svg-icon></pre>
          Easier for drag/drop interactions. The whole square IMG is the click target.
          <p></p>
          <svg-icon is="im" img=""></svg-icon>
          The SVG is injected as Inline-SVG:
          <pre class="code">&lt;svg-icon>&lt;svg >&lt;svg-icon></pre>
          Easier for styling and animating SVG with CSS. Be aware of
          <a href="https://www.smashingmagazine.com/2018/05/svg-interaction-pointer-events-property/" target="_blank"
            >pointer-events/click-target issues</a
          >
        </div>
      </section>
      <section id="_configureElementAttributes">
        <h3>Configure single Element with Attributes:</h3>
        <div id="$demoicons">
          <svg-icon is="im"></svg-icon>
          <svg-icon is="im" stroke="yellow"></svg-icon>
          <svg-icon is="im" width=".5"></svg-icon>
          <svg-icon is="im" fill="red"></svg-icon>
          <svg-icon is="im" rotate="45"></svg-icon>
          <svg-icon is="im" scale=".5"></svg-icon>
          <svg-icon is="im" opacity=".5"></svg-icon>
          <svg-icon is="im" tile="lightgreen"></svg-icon>
          <svg-icon is="im" border="stroke='red' stroke-width='3' stroke-dasharray='3 3 3'"></svg-icon>
          <svg-icon is="im" xy="1 -1"></svg-icon>
          <svg-icon is="im" w="16" h="16"></svg-icon>
        </div>
        <h3>
          Configure single Element with Properties:
        </h3>
        <div>
          Mouse over these icons
          <span id="$coloricons">
            <svg-icon stroke="yellow" fill="red"></svg-icon>
            <svg-icon stroke="red" fill="yellow"></svg-icon>
            <svg-icon stroke="green" fill="pink"></svg-icon>
            <svg-icon stroke="blue" fill="gold"></svg-icon>
            <svg-icon stroke="hotpink" fill="teal"></svg-icon>
          </span>
          to execute:
          <pre class="code">
        demoicon.tile = coloricon.fill; 
        demoicon.stroke = coloricon.stroke;
        demoicon.width = 1; 
        demoicon.scale = 1.7
      </pre
          >
        </div>
      </section>
      <section>
        <h3>Configure multiple Elements with CSS Properties:</h3>
        <div>
          <style id="CSSpropertiesStyle">
            #CSSproperties > svg-icon {
              --color: red;
              --radius: 3;
              --svg-icon-stroke: var(--color);
              --svg-icon-width: 0.5;
              --svg-icon-fill: green;
              --svg-icon-rotate: 45;
              --svg-icon-rect: "<circle cx='4.5' cy='4.5' r='" var(--radius) "' fill='yellow'/>";
            }
          </style>
          <div displaystyle="CSSpropertiesStyle"></div>
          <div id="CSSproperties">
            <svg-icon is="im"></svg-icon>
            <svg-icon is="im"></svg-icon>
            <svg-icon is="im"></svg-icon>
          </div>
        </div>
        <h3>Example #1 - Scrabble tiles</h3>
        <div>
          <p>
            IconMeister has 3 pre-defined variables (both attribute and property access) you can freely use: v1, v2, v3
          </p>
          <style id="CSSscrabbleStyle">
            #_scrabble svg-icon {
              background: none; /* cancel global background:grey above*/
            }
            #_scrabble {
              --svg-icon-box: 100;
              --tile: "<rect width='100%' height='100%' fill='#e6c998' rx='15' />";
              --letter: "<text x='40' y='75' font-size='70' font-family='arial' text-anchor='middle'>{v1}</text>";
              --value: "<text x='75' y='80' font-size='25' font-family='arial' text-anchor='middle'>{v2}</text>";
              --svg-icon-rect: var(--tile) var(--letter) var(--value);
            }
          </style>
          <div displaystyle="CSSscrabbleStyle"></div>
          <div displaystyle="_scrabble"></div>
          <div id="_scrabble">
            <svg-icon v1="I" v2="2"></svg-icon>
            <svg-icon v1="c" v2="3"></svg-icon>
            <svg-icon v1="o" v2="5"></svg-icon>
            <svg-icon v1="n" v2="9"></svg-icon>
            <svg-icon v1="M" v2="3"></svg-icon>
            <svg-icon v1="e" v2="2"></svg-icon>
            <svg-icon v1="i" v2="1"></svg-icon>
            <svg-icon v1="s" v2="7"></svg-icon>
            <svg-icon v1="t" v2="6"></svg-icon>
            <svg-icon v1="e" v2="4"></svg-icon>
            <svg-icon v1="r" v2="2"></svg-icon>
          </div>
        </div>
      </section>
      <section class="scollsnap">
        <div id="_codegenerator">
          <h2>IconMeister Code Generator SCRIPT:</h2>
          <p>
            Copy this code into the HTML document. In the HEAD if you want the &ltsvg-icon> Custom Element declared
            asap<br />
            You might need a
            <a href="https://developers.google.com/web/fundamentals/security/csp/#if_you_absolutely_must_use_it"
              >CSP nonce</a
            >.<br />
            Or import it. It is an IIFE, so will not touch the global scope.
          </p>
          <p>You can ofcourse rename the iconname to anything you want</p>
          <p id="_codeinfo">
            IconMeister: <span id="_elementsCodeIMSize">000</span> Bytes +
            <b><span id="_elementsCodeIconCount"></span></b> icons = <span id="_elementsCodeSize">000</span> Bytes (but
            only HTTP delivered GZip size counts)
          </p>
          <textarea id="_elementsCode"></textarea>
          <div id="_selectedIcons"></div>
        </div>
        <div id="_sectionAvailableIcons">
          <h3 id="iconsheader">Available Icons:</h3>
          <div id="Bootstrap" class="iconlist" src="icons-bootstrap.json" uri="//icons.getbootstrap.com/">
            <style>
              #Bootstrap {
                /* --svg-icon-width: 1; */
                /* --svg-icon-fill: none; */
              }
            </style>
          </div>
          <div id="Feather" class="iconlist" src="icons-feather.json" uri="//feathericons.com/">
            <style>
              #Feather {
                --svg-icon-stroke: blue;
                --svg-icon-width: 2;
                --svg-icon-fill: none;
              }
            </style>
          </div>
          <div id="Clarity" class="iconlist" src="icons-clarity.json" uri="//clarity.design/icons">
            <style>
              #Clarity {
                --svg-icon-width: 0;
                --svg-icon-fill: #000;
              }
            </style>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <b>More Meisters: </b>
      <a href="cardmeister.github.io" target="blank">CardMeister</a> ,
      <a href="flagmeister.github.io" target="blank">FlagMeister</a> ,
      <a href="chessmeister.github.io" target="blank">ChessMeister</a> ,
      <a href="iconmeister.github.io" target="blank">IconMeister</a>
    </footer>
    <script>
      let icons = document.getElementsByTagName("svg-icon"); // keep a live nodelist

      const redrawIcon = (icon) => (icon.is = icon.is);
      const redrawIcons = (icons) => [...icons].map(redrawIcon); // update all existing icons

      function addIconMeisterIcon(name, str, redraw = false) {
        let iconsAPI = document.querySelector("svg-icon").api[0]; //0 = ICONs, 1 = FUNCs
        iconsAPI[name] = str;
        if (redraw) redrawIcons(icons);
      }
      addIconMeisterIcon("im", "box:9;path:m3 3h3v3h-3z");
    </script>
    <script>
      window.onload = () => {
        let totaliconcount = 0;
        let demoicons = $demoicons.getElementsByTagName("svg-icon");
        let docicons = $demoicons.getElementsByClassName("demohtml");

        const JSONstring = (obj) => JSON.stringify(obj);
        const setProperties = (obj, propes) => Object.assign(obj, props);
        const setAttributes = (obj, attrs) => Object.entries(attrs).map((entry) => obj.setAttribute(...entry));
        const createElement = (tag, attributes = {}) => (
          (tag = document.createElement(tag)), setAttributes(tag, attributes), tag
        );
        const getElementById = (id, d = document) => d.getElementById(id);
        const removeNodes = (nodes) => [...nodes].forEach((el) => el.remove());
        const addHTML = (el, html, type = "afterend") => el.insertAdjacentHTML(type, html);
        const escapeHTML = (html) => html.replace(/\</g, "&lt;");
        const PRE = (html) => `<div class=code>${html}</div>`;

        //todo same function
        const openingTag = (icon) => escapeHTML(icon.outerHTML.match("<svg-icon .*?>")[0]);
        const iconHTML = (icon) => escapeHTML(icon.outerHTML.split('">')[0]);

        const iconDOC = (icon) => addHTML(icon, `<span class="demohtml">${iconHTML(icon)}"><br></span>`);
        const documentIcons = () => removeNodes(docicons) | [...demoicons].forEach(iconDOC);

        const saveLocalStorage = (selected) =>
          localStorage.setItem(
            "iconmeister",
            JSONstring({
              selected,
            })
          );
        const loadLocalStorage = () => {
          let obj = JSON.parse(localStorage.getItem("iconmeister")) || false;
          console.log(21, obj);
          if (obj) obj.selected.forEach(appendSelectedIconByName);
          else {
            appendSelectedIconByName("bi-gear");
            appendSelectedIconByName("f-settings");
            appendSelectedIconByName("cl-core-cog-line");
          }
        };

        const createIconElement = ([is, attrs]) => createElement("svg-icon", { is, attrs });
        const getSelectedIcons = () => [..._selectedIcons.querySelectorAll("svg-icon[selected]")];
        const getSelectedAvailableIcons = () => [..._sectionAvailableIcons.querySelectorAll("svg-icon[selected]")];

        const updateSelectedIcons = () => {
          _selectedIcons.innerHTML = "";
          _selectedIcons.append(...getSelectedAvailableIcons().map(appendSelectedIcon));
          redrawIcons(selected);
        };

        const appendSelectedIcon = (icon) => {
          if (!icon) return;
          const removeSelected = () => {
            icon.removeAttribute("selected");
            if (icon.selectedIcon) icon.selectedIcon.remove();
            setElementsCode();
          };
          if (icon.toggleAttribute("selected")) {
            newicon = icon.cloneNode(true);
            icon.selectedIcon = newicon;
            newicon.onclick = removeSelected;
            _selectedIcons.append(newicon);
          } else {
            removeSelected();
          }
          setElementsCode();
        };

        const appendSelectedIconByName = (name) => {
          let icons = [...document.querySelectorAll(`svg-icon[is="${name}"]`)];
          console.log(`adding ${icons.length} icons`);
          icons.forEach(appendSelectedIcon);
        };

        documentIcons();

        document.querySelectorAll("[displaystyle]").forEach((styleElement) => {
          const attr = styleElement.getAttribute("displaystyle");
          const tag = getElementById(attr);
          const html = tag.innerHTML;
          let new_html = "";
          if (tag.nodeName == "STYLE") {
            new_html = PRE(escapeHTML(html));
          } else {
            let openingTags = "\t" + [...tag.children].map(openingTag).join`\n\t`;
            new_html = PRE(openingTags).replace(/"/g, "") + " \n\n";
          }
          addHTML(styleElement, new_html);
        });

        const loadStatus = (txt = "") => (_loadstatus.innerHTML = txt);

        function loadIcons(list) {
          const file = list.getAttribute("src");
          loadStatus(`Loading: ${file}`);
          return new Promise((resolve, reject) => {
            fetch(file, { mode: "cors" })
              .then((response) => response.json())
              .then((response) => {
                const uri = list.getAttribute("uri");
                const entries = Object.entries(response).slice(0, 19);
                const html = `<h4>${entries.length} ${list.id} Icons <span><a href='${uri}'>${uri}</a></span></h4>`;
                addHTML(list, html, "beforebegin");
                console.log(entries.length, uri);
                totaliconcount += entries.length;
                _iconcount.innerHTML = totaliconcount;

                const appendIcons = (start) => {
                  const end = start + 50;
                  const addicons = entries.slice(start, end);
                  loadStatus(`Parsing ${start}...${end} of ${entries.length} icons from ${file}`);
                  addicons.map(([is, str]) => addIconMeisterIcon(is, str));
                  const newicons = addicons.map(createIconElement);
                  list.append(...newicons);
                  redrawIcons(newicons);
                  if (end < entries.length) setTimeout(() => appendIcons(end), 0);
                  else {
                    console.timeLog(list.id);
                    list.onclick = (evt) => appendSelectedIcon(evt.target.closest("svg-icon"));
                    resolve(list);
                  }
                };

                setTimeout(() => {
                  console.time(list.id);
                  appendIcons(0);
                });
              });
          });
        }

        const fetchFile = (file, callback) => {
          fetch(file)
            .then((response) => response.text())
            .then(callback);
        };

        let elementsCodeSource = "";
        const setElementsCode = (txt = elementsCodeSource) => {
          elementsCodeSource = txt;
          _elementsCodeIMSize.innerHTML = txt.length;
          let iconsJSON = {};
          let iconNames = getSelectedIcons().map(({ is, api }) => {
            iconsJSON[is] = api[0][is];
            return is;
          });
          saveLocalStorage(iconNames);
          _elementsCodeIconCount.innerHTML = Object.keys(iconsJSON).length;
          const addLineBreaks = (x) => JSONstring(x).replace(/\",\"/g, '",\n"');
          let iconsSTR = `(\n${addLineBreaks(iconsJSON)})`;
          let formattedIconsSTR = 0;
          let IMscript = `&lt;script>\n${txt}\n&lt;/script>`.replace(/\(\{\}\)/, iconsSTR);
          _elementsCode.innerHTML = IMscript;
          _elementsCode.style.height = "";
          _elementsCode.style.height = _elementsCode.scrollHeight + "px";
          _elementsCodeSize.innerHTML = IMscript.length;
          _elementsCode.scrollTop = _elementsCode.scrollHeight;
        };

        redrawIcons(icons);

        Promise.all([...document.getElementsByClassName("iconlist")].map(loadIcons)).then((lists) => {
          fetchFile("elements.iconmeister.min.js", (response) => {
            elementsCodeSource = response;
            loadLocalStorage();
            fetchFile("gzip-bundle", (response) => {
              console.log(response.length, "bytes in gzip-bundle");
              //              elementsSize.innerHTML = response.length;
              loadStatus();
            });
            //_codeinfo.scrollIntoView(true);
          });
        });

        $coloricons.querySelectorAll("svg-icon").forEach((icon) => {
          const demoicons = $demoicons.querySelectorAll("[is=im]");
          const color = icon.stroke;
          const style = (i, tile, stroke, width, scale) => (
            (i.tile = tile), (i.stroke = stroke), (i.width = width), (i.scale = scale)
          );
          const setIcon = (di) => style(di, icon.fill, icon.stroke, 0.5, 1.7);
          const unsetIcon = (di) => style(di, "none", "blue", 1, 1);
          const changeIcons = (func) => {
            // _configureElementAttributes.scrollIntoView(true);
            _main.scroll({
              top: 300,
              left: 0,
              behavior: "smooth",
            });

            demoicons.forEach(func);
            documentIcons();
          };
          icon.is = "im";
          icon.onmouseover = () => changeIcons(setIcon);
          icon.onmouseout = () => changeIcons(unsetIcon);
        });
      };
    </script>
  </body>
</html>
